filter {
    grok {
        match => { 
            "message" => ["%{IPORHOST:clientip} - %{USER:ident} %{USER:auth} \[%{TIMESTAMP_ISO8601:timestamp}\] \"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest})\" %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{QS:referrer} %{QS:agent}"]
        }
        remove_field => "message"
    }
    mutate {
        add_field => { "read_timestamp" => "%{@timestamp}" }
        add_field => { "type" => "apache_logs" }
    }
    date {
        match => [ "timestamp", "ISO8601" ]
        timezone => "Europe/Berlin"
        remove_field => "timestamp"
    }
    useragent {
        source => "agent"
        target => "user_agent"
        remove_field => "agent"
    }
    geoip {
        source => "clientip"
        target => "geoip"
    }
}
